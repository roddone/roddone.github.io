<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Contrôler ses ampoules Yeelight en C# - Romain ODDONE</title><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://blog.roddone.ovh/controler-ses-ampoules-yeelight-en-c/"><link rel="amphtml" href="https://blog.roddone.ovh/amp/controler-ses-ampoules-yeelight-en-c/"><link type="application/atom+xml" rel="alternate" href="https://blog.roddone.ovh/feed.xml"><meta property="og:title" content="Contrôler ses ampoules Yeelight en C#"><meta property="og:image" content="https://blog.roddone.ovh/media/posts/1/ifttt2.png"><meta property="og:site_name" content="Romain ODDONE"><meta property="og:description" content="Yeelight est la solution de luminaires connectés de Xiaomi. Contrairement aux périphériques Phillips Hue, celles-ci sont directement connectées en Wi-fi et ne nécessitent pas de pont pour les connecter. Ce système a ses avantages et inconvénients mais permet de débuter dans le monde des objets connectés&hellip;"><meta property="og:url" content="https://blog.roddone.ovh/controler-ses-ampoules-yeelight-en-c/"><meta property="og:type" content="article"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Roboto:400,500&amp;subset=latin-ext" rel="stylesheet"><link rel="stylesheet" href="https://blog.roddone.ovh/assets/css/style.css?v=b11f7c291bbcf9c0e33156e303669ff5"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.roddone.ovh/controler-ses-ampoules-yeelight-en-c/"},"headline":"Contrôler ses ampoules Yeelight en C#","datePublished":"2018-10-08T11:25","dateModified":"2018-10-09T14:21","image":{"@type":"ImageObject","url":"https://blog.roddone.ovh/media/posts/1/ifttt2.png","height":229,"width":415},"description":"Yeelight est la solution de luminaires connectés de Xiaomi. Contrairement aux périphériques Phillips Hue, celles-ci sont directement connectées en Wi-fi et ne nécessitent pas de pont pour les connecter. Ce système a ses avantages et inconvénients mais permet de débuter dans le monde des objets connectés&hellip;","author":{"@type":"Person","name":"Romain ODDONE"},"publisher":{"@type":"Organization","name":"Romain ODDONE"}}</script><script async src="https://blog.roddone.ovh/assets/js/lazysizes.min.js?v=739e7d27e1cbc58b1b2e6882674b8867"></script><style></style><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-139506649-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag() { dataLayer.push(arguments); }
gtag('js', new Date());

gtag('config', 'UA-139506649-1');</script></head><body><header class="topbar js-top is-sticky"><div class="topbar__inner"><a class="logo" href="https://blog.roddone.ovh">Romain ODDONE</a><nav class="navbar js-navbar"><button class="navbar__toggle js-navbar__toggle">Menu</button><ul class="navbar__menu"><li><a href="https://github.com/roddone/yeelightAPI" target="_self">YeelightAPI</a></li><li><a href="https://github.com/roddone/BetaSeries.Net" target="_blank">Betaseries.Net</a></li><li><a href="https://www.paypal.me/roddone" target="_blank">DONATE</a></li></ul></nav></div></header><div class="content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2019-05-03T17:56">mai 3, 2019</time></div></div><main class="main"><article class="post"><figure class="post__featured-image" style="padding-bottom: calc(229/415 * 100%)"><img class="lazyload" src="https://blog.roddone.ovh/media/posts/1/responsive/ifttt2-xs.png" data-srcset="https://blog.roddone.ovh/media/posts/1/responsive/ifttt2-xs.png 300w ,https://blog.roddone.ovh/media/posts/1/responsive/ifttt2-sm.png 480w ,https://blog.roddone.ovh/media/posts/1/responsive/ifttt2-md.png 768w ,https://blog.roddone.ovh/media/posts/1/responsive/ifttt2-lg.png 1024w ,https://blog.roddone.ovh/media/posts/1/responsive/ifttt2-xl.png 1360w ,https://blog.roddone.ovh/media/posts/1/responsive/ifttt2-2xl.png 1600w" data-sizes="auto" alt=""></figure><header class="u-header post__header"><h1>Contrôler ses ampoules Yeelight en C#</h1><div class="u-header__meta u-small"><img class="lazyload u-header__avatar" data-src="https://blog.roddone.ovh/media/website/profilepicture.jpg" alt="Romain ODDONE"><div><a href="https://blog.roddone.ovh/authors/romain-oddone/" title="Romain ODDONE">Romain ODDONE</a> <time datetime="2018-10-08T11:25">octobre 8, 2018</time></div></div></header><div class="post__entry u-inner"><p>Yeelight est la solution de luminaires connectés de Xiaomi. Contrairement aux périphériques Phillips Hue, celles-ci sont directement connectées en Wi-fi et ne nécessitent pas de pont pour les connecter. </p><p>Ce système a ses avantages et inconvénients mais permet de débuter dans le monde des objets connectés à faible coût (compter environ 20€ pour une ampoule couleur).</p><p>Ce qui nous intéresse ici est surtout de les contrôler via une API, c'est ce que je me suis efforcé de faire dans <a href="http://github.com/roddone/YeelightAPI" title="Lien vers le github de YeelightAPI" target="_blank" rel="noopener noreferrer">YeelightAPI</a>. Dans sa grande bonté, Yeelight met à disposition des développeurs une <a href="https://www.yeelight.com/download/Yeelight_Inter-Operation_Spec.pdf" title="Lien vers la documentation officielle Yeelight" target="_blank" rel="noopener noreferrer">documentation </a>technique expliquant leur protocole et les différentes méthodes disponibles. Les deux principales fonctionnalités étant la découverte de périphériques et leur contrôle, j'ai pu les implémenter grâce à cette documentation.</p><p>La découverte des périphériques se base sur le protocole SSDP (UDP) et permet non seulement de récupérer les périphériques sur le réseau (modèle, hostname, version de firmware) mais également leurs capacités (changement de couleur, luminosité, température etc.).</p><p>Le contrôle se fait par des requêtes TCP dont la requête au format JSON contient le nom de la méthode à appeler ainsi que les différents paramètres. On peut ainsi allumer/éteindre, changer la couleur/luminosité/température, démarrer des scènes etc. Les appels sont ensuite automatiquement suivis d'une réponse du device (toujours en JSON) indiquant simplement "ok" en cas de succès, ou un code + message d'erreur si la requête a échoué.</p><p>Autre chose assez pratique pour suivre l'état d'un Device : dès qu'une action est faîte sur un device, celui-ci envoi une notification indiquant la propriété ayant changé ainsi que sa nouvelle valeur.</p><p>Pour simplifier tout cela, j'ai conçu <a href="http://github.com/roddone/YeelightAPI" title="Lien vers le github de YeelightAPI">YeelightAPI</a> comme un wrapper autour des différentes méthodes afin de simplifier leur appel.</p><p>Pour cela rien deplus simple, la classe <code>DeviceLocator</code> permet de lancer une recherche des périphériques sur le réseau. Ces périphériques sont des objets de type <code>Device</code> et possèdent toutes les méthodes possibles. Un objet <code>DeviceGroup</code> permet de contrôler plusieurs Devices en même temps. Pour finir, toute l'API est basée sur le système d'async/await de C#. La documentation complète se trouve sur <a href="http://github.com/roddone/YeelightAPI" title="Lien vers le github de YeelightAPI">github</a>.</p></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on octobre 9, 2018</div><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.roddone.ovh%2Fcontroler-ses-ampoules-yeelight-en-c%2F" class="js-share facebook" title="Share with Facebook" rel="nofollow"><svg class="u-icon"><use xlink:href="https://blog.roddone.ovh/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fblog.roddone.ovh%2Fcontroler-ses-ampoules-yeelight-en-c%2F&amp;via=Romain%20ODDONE&amp;text=Contr%C3%B4ler%20ses%20ampoules%20Yeelight%20en%20C%23" class="js-share twitter" title="Share with Twitter" rel="nofollow"><svg class="u-icon"><use xlink:href="https://blog.roddone.ovh/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://plus.google.com/share?url=https%3A%2F%2Fblog.roddone.ovh%2Fcontroler-ses-ampoules-yeelight-en-c%2F" class="js-share gplus" title="Share with Google Plus" rel="nofollow"><svg class="u-icon"><use xlink:href="https://blog.roddone.ovh/assets/svg/svg-map.svg#gplus"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fblog.roddone.ovh%2Fcontroler-ses-ampoules-yeelight-en-c%2F&amp;media=undefined
                     &amp;description=Contr%C3%B4ler%20ses%20ampoules%20Yeelight%20en%20C%23" class="js-share pinterest" title="Share with Pinterest" rel="nofollow"><svg class="u-icon"><use xlink:href="https://blog.roddone.ovh/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="http://www.stumbleupon.com/submit?url=https%3A%2F%2Fblog.roddone.ovh%2Fcontroler-ses-ampoules-yeelight-en-c%2F&amp;title=Contr%C3%B4ler%20ses%20ampoules%20Yeelight%20en%20C%23" class="js-share stumbleupon" title="Share with StumbleUpon" rel="nofollow"><svg class="u-icon"><use xlink:href="https://blog.roddone.ovh/assets/svg/svg-map.svg#stumbleupon"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.roddone.ovh%2Fcontroler-ses-ampoules-yeelight-en-c%2F&amp;title=Contr%C3%B4ler%20ses%20ampoules%20Yeelight%20en%20C%23" class="js-share linkedin" title="Share with LinkedIn" rel="nofollow"><svg class="u-icon"><use xlink:href="https://blog.roddone.ovh/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://buffer.com/add?text=Contr%C3%B4ler%20ses%20ampoules%20Yeelight%20en%20C%23&amp;url=https%3A%2F%2Fblog.roddone.ovh%2Fcontroler-ses-ampoules-yeelight-en-c%2F" class="js-share buffer" title="Share with Buffer" rel="nofollow"><svg class="u-icon"><use xlink:href="https://blog.roddone.ovh/assets/svg/svg-map.svg#buffer"/></svg></a></div></aside><footer class="post__footer"><a href="https://blog.roddone.ovh/controler-ses-ampoules-yeelight-en-c/#disqus_thread" data-disqus-identifier="1" class="u-comment-count" rel="nofollow">0</a><ul class="post__tag box"><li><a href="https://blog.roddone.ovh/p/net/" class="u-tag u-tag--1" title=".net">.net</a></li><li><a href="https://blog.roddone.ovh/p/bulb/" class="u-tag u-tag--1" title="bulb">bulb</a></li><li><a href="https://blog.roddone.ovh/p/c/" class="u-tag u-tag--1" title="c#">c#</a></li><li><a href="https://blog.roddone.ovh/p/iot/" class="u-tag u-tag--1" title="iot">iot</a></li><li><a href="https://blog.roddone.ovh/p/library/" class="u-tag u-tag--1" title="library">library</a></li><li><a href="https://blog.roddone.ovh/p/xiaomi/" class="u-tag u-tag--1" title="xiaomi">xiaomi</a></li><li><a href="https://blog.roddone.ovh/p/yeelight/" class="u-tag u-tag--1" title="yeelight">yeelight</a></li></ul><div class="post__bio u-author box"><img class="lazyload u-author__avatar" data-src="https://blog.roddone.ovh/media/website/profilepicture.jpg" alt="Romain ODDONE"><div><h4 class="u-author__name"><a href="https://blog.roddone.ovh/authors/romain-oddone/" title="Romain ODDONE">Romain ODDONE</a></h4><p>Technical Leader @ Publicis-ETO&lt;br/&gt; Développeur Full-Stack .Net &amp; JavaScript</p></div></div><nav class="post__nav box"><div class="post__nav__next"><a href="https://blog.roddone.ovh/acceder-a-son-planning-de-serie-vore-avec-betaseriesnet/" class="post__nav__link" rel="next"><div class="u-small">Next Post<h5>Accéder à son planning de sérievore avec Betaseries.Net</h5></div><img class="lazyload" src="https://blog.roddone.ovh/media/posts/3/responsive/betaseries_1980-xs.png" data-srcset="https://blog.roddone.ovh/media/posts/3/responsive/betaseries_1980-xs.png" data-expand="300" alt=""></a></div></nav><div class="post__related box"><h3 class="box__title">Related posts</h3><div class="post__related__wrap"><figure><a href="https://blog.roddone.ovh/acceder-a-son-planning-de-serie-vore-avec-betaseriesnet/"><img class="lazyload" src="https://blog.roddone.ovh/media/posts/3/responsive/betaseries_1980-xs.png" data-srcset="https://blog.roddone.ovh/media/posts/3/responsive/betaseries_1980-xs.png" data-expand="300" alt=""></a><figcaption><h4><a href="https://blog.roddone.ovh/acceder-a-son-planning-de-serie-vore-avec-betaseriesnet/" class="inverse">Accéder à son planning de sérievore avec Betaseries.Net</a></h4><time datetime="2018-10-09T15:31" class="u-small">octobre 9, 2018</time></figcaption></figure><figure><a href="https://blog.roddone.ovh/gerer-ses-chargements-avec-angular-js-1x/"><img class="lazyload" src="https://blog.roddone.ovh/media/posts/4/responsive/800px-AngularJS_logo.svg1-xs.png" data-srcset="https://blog.roddone.ovh/media/posts/4/responsive/800px-AngularJS_logo.svg1-xs.png" data-expand="300" alt=""></a><figcaption><h4><a href="https://blog.roddone.ovh/gerer-ses-chargements-avec-angular-js-1x/" class="inverse">Gérer ses temps de chargements Ajax avec Angular JS 1.x</a></h4><time datetime="2018-10-22T16:41" class="u-small">octobre 22, 2018</time></figcaption></figure></div></div></footer></article><div class="comments box"><h3 class="box__title">Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
                 this.page.url = 'https://blog.roddone.ovh/controler-ses-ampoules-yeelight-en-c/';
         		this.page.identifier = '1';
                 this.page.title = 'Contrôler ses ampoules Yeelight en C# - Romain ODDONE ';
             };
         
             var disqus_loaded = false;
         
             function publiiLoadDisqus() {
                 if(disqus_loaded) {
                     return false;
                 }
         
                 var top = document.getElementById('disqus_thread').offsetTop;
         
                 if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                     disqus_loaded = true;
         
                     (function () {
                         var d = document, s = d.createElement('script');
                         s.src = '//roddone-github-io.disqus.com/embed.js';
                         s.setAttribute('data-timestamp', +new Date());
                         (d.head || d.body).appendChild(s);
                     })();
                 }
             }
         
             publiiLoadDisqus();
         
             window.onscroll = function() {
                 publiiLoadDisqus();
             };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></main><div class="sidebar"><section class="box"><h3 class="box__title">Follow us</h3><div class="follow"><a href="https://twitter.com/romainoddone" class="twitter" aria-label="Twitter"><svg class="u-icon"><use xlink:href="https://blog.roddone.ovh/assets/svg/svg-map.svg#twitter"/></svg> Twitter </a><a href="https://linkedin.com/in/romain-oddone" class="linkedin" aria-label="LinkedIn"><svg class="u-icon"><use xlink:href="https://blog.roddone.ovh/assets/svg/svg-map.svg#linkedin"/></svg> LinkedIn</a></div></section><section class="box"><h3 class="box__title">Authors</h3><ul class="authors"><li><a href="https://blog.roddone.ovh/authors/romain-oddone/"><img data-src="https://blog.roddone.ovh/media/website/profilepicture.jpg" class="lazyload authors__img" alt="Romain ODDONE"></a><div><a href="https://blog.roddone.ovh/authors/romain-oddone/" class="authors__title">Romain ODDONE</a><div><small>Technical Leader @ Publicis-ETO<br>Développeur Full-Stack .Net & JavaScript</small></div><span class="u-small">Post: 5</span></div></li></ul></section><section class="box"><h3 class="box__title">Tags</h3><ul class="tags"><li><a href="https://blog.roddone.ovh/p/net/">.net</a> <span class="u-small">(2)</span></li><li><a href="https://blog.roddone.ovh/p/aws/">AWS</a> <span class="u-small">(1)</span></li><li><a href="https://blog.roddone.ovh/p/alexa/">Alexa</a> <span class="u-small">(1)</span></li><li><a href="https://blog.roddone.ovh/p/nodejs/">Node.Js</a> <span class="u-small">(1)</span></li><li><a href="https://blog.roddone.ovh/p/typescript/">TypeScript</a> <span class="u-small">(1)</span></li><li><a href="https://blog.roddone.ovh/p/angularjs/">angular.js</a> <span class="u-small">(1)</span></li><li><a href="https://blog.roddone.ovh/p/ask-sdk/">ask-sdk</a> <span class="u-small">(1)</span></li><li><a href="https://blog.roddone.ovh/p/betaseries/">betaseries</a> <span class="u-small">(2)</span></li><li><a href="https://blog.roddone.ovh/p/bulb/">bulb</a> <span class="u-small">(1)</span></li><li><a href="https://blog.roddone.ovh/p/c/">c#</a> <span class="u-small">(2)</span></li></ul></section></div><footer class="footer"><a class="footer__logo" href="https://blog.roddone.ovh">Romain ODDONE</a><nav><ul class="footer__nav"></ul></nav><div class="footer__follow"><a href="https://twitter.com/romainoddone" aria-label="Twitter"><svg><use xlink:href="https://blog.roddone.ovh/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://linkedin.com/in/romain-oddone" aria-label="LinkedIn"><svg><use xlink:href="https://blog.roddone.ovh/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">© 2019 Romain ODDONE - Powered by Publii</div></footer></div><script defer="defer" src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g=" aria-dropeffect="" crossorigin="anonymous"></script><script defer="defer" src="https://blog.roddone.ovh/assets/js/scripts.min.js?v=07b53ae91f8045eab042a695e4a26034"></script><script id="dsq-count-scr" src="//roddone-github-io.disqus.com/count.js" async></script><div class="cookie-popup js-cookie-popup cookie-popup--uses-badge"><h2>Ce site utilise des cookies</h2><p>Ce site enregistre des cookies sur votre ordinateur pour vous fournir une meilleure expérience. <a href="#not-specified"></a></p><form><p class="cookie-popup__save-wrapper"><button type="submit" class="cookie-popup__save">Ok</button></p></form><span class="cookie-popup-label">Cookie Policy</span></div><script>(function() {
                function addScript (src, inline) {
                    var newScript = document.createElement('script');

                    if (src) {
                        newScript.setAttribute('src', src);
                    }

                    if (inline) {
                        newScript.text = inline;
                    }

                    document.body.appendChild(newScript);
                }

                var popup = document.querySelector('.js-cookie-popup');
                var checkboxes = popup.querySelectorAll('input[type="checkbox"]');
                var save = popup.querySelector('button');
                var currentConfig = localStorage.getItem('publii-gdpr-allowed-cookies');
                var blockedScripts = document.querySelectorAll('script[type^="gdpr-blocker/"]');
                

                popup.addEventListener('click', function() {
                    if (!popup.classList.contains('cookie-popup--is-sticky')) {
                        popup.classList.add('cookie-popup--is-sticky');
                    }
                });

                save.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    popup.classList.remove('cookie-popup--is-sticky');
                    var allowedGroups = [];

                    for (var i = 0; i < checkboxes.length; i++) {
                        if (checkboxes[i].checked) {
                            var groupName = checkboxes[i].getAttribute('name').replace('gdpr-', '');
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + groupName + '"]');

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }

                            allowedGroups.push(groupName);
                        }
                    }

                    localStorage.setItem('publii-gdpr-allowed-cookies', allowedGroups.join(','));
                    popup.classList.remove('cookie-popup--is-sticky');

                    setTimeout(function () {
                        if (currentConfig !== null) {
                            window.location.reload();
                        }
                    }, 250);
                });

                if (currentConfig === null) {
                    popup.classList.add('cookie-popup--is-sticky');
                } else {
                    if (currentConfig !== '') {
                        var allowedGroups = currentConfig.split(',');

                        for (var i = 0; i < allowedGroups.length; i++) {
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroups[i] + '"]');
                            var checkbox = popup.querySelector('input[type="checkbox"][name="gdpr-' + allowedGroups[i] + '"]');

                            if (checkbox) {
                                checkbox.checked = true;
                            }

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }
                        }
                    }
                }
            })();</script></body></html>